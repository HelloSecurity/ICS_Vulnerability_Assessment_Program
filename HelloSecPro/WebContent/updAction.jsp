<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="utf-8"%>
<%@ page import="user.UserDAO" %>
<%@ page import="asset.AssetDAO" %>
<%@ page import="asset.Asset" %>
<%@ page import="java.io.PrintWriter" %>
<%@ page import="java.sql.*,java.util.*" %>


<%//*****자산 수정하는 파일, 미완.
    request.setCharacterEncoding("UTF-8");
%>

<jsp:setProperty name="asset" property="asset_name" />
<jsp:setProperty name="asset" property="priority" />
<jsp:setProperty name="asset" property="account_manage" />
<jsp:setProperty name="asset" property="encryption" />
<jsp:setProperty name="asset" property="logging" />
<jsp:setProperty name="asset" property="external_connect" />
<jsp:setProperty name="asset" property="asset_type" />
<jsp:setProperty name="asset" property="inter_face" />
<jsp:setProperty name="asset" property="protocol" />
<jsp:setProperty name="asset" property="os_type" />
<jsp:setProperty name="asset" property="usages" />


<%--
request.setCharacterEncoding("utf-8");
String re_asset_name=request.getParameter("asset_name");                  
String re_priority=request.getParameter("priority");      
String re_account_manage=request.getParameter("account_manage");                  
String re_encryption=request.getParameter("encryption");                  
String re_logging=request.getParameter("logging");                  
String re_external_connect=request.getParameter("external_connect");                  
String re_asset_type=request.getParameter("asset_type");        
String re_inter_face=request.getParameter("inter_face");
String re_protocol=request.getParameter("protocol");
String re_os_type=request.getParameter("os_type");
String re_usages=request.getParameter("usages");

int num=Integer.parseInt(request.getParameter("no"));
 
      Connection conn = null;
      PreparedStatement pstmt = null;
      ResultSet rs = null;
 
      try
      {
    	  String dbURL ="jdbc:mysql://ics-vaprogram.cti5lacaght2.ap-northeast-2.rds.amazonaws.com:3306/ICS2?useUnicode=true&characterEncoding=utf8";	       
    		String dbID = "admin";
    		String dbPassword = "password";
              
    		Class.forName("com.mysql.cj.jdbc.Driver");
    		 conn= DriverManager.getConnection(dbURL, dbID, dbPassword);

    			  pstmt = conn.prepareStatement("UPDATE AssetTable SET asset_name=?,priority=?,account_manage=?,encryption=?,logging=?,external_connect=?,asset_type=?,inter_face=?,protocol=?,os_type=?,usages=? WHERE no=?");
    			  pstmt.setString(1, re_asset_name);
	              pstmt.setString(2, re_priority);
	              pstmt.setString(3, re_account_manage);
	              pstmt.setString(4, re_encryption);
	              pstmt.setString(5, re_logging);
	              pstmt.setString(6, re_external_connect);
	              pstmt.setString(7, re_asset_type);
	              pstmt.setString(8, re_inter_face);
	              pstmt.setString(9, re_protocol);
	              pstmt.setString(10, re_os_type);
	              pstmt.setString(11, re_usages);
	              pstmt.setInt(12, re_no);

    			  int result = pstmt.executeUpdate();
    			   
    			  disconnect();
    			   
    			  return result;
    			


--%>

<!DOCTYPE html >
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>취약점 진단 프로그램</title>
</head>
<body>
<%
   String userID=null;
   if(session.getAttribute("userID")!=null){
      userID=(String)session.getAttribute("userID");
   }
   if(userID==null){
      PrintWriter script=response.getWriter();
      script.println("<script>");
      script.println("alert('로그인을 하세요.')");
      script.println("location.href='login.jsp'");
      script.println("</script>");
   } 
   int no=0;
   if(request.getParameter("no")!=null){
	   no=Integer.parseInt(request.getParameter("no"));
   }
if(no==0){
	PrintWriter script=response.getWriter();
	script.println("<script>");
	script.println("alert('유효하지 않은 자산입니다.')");
	script.println("location.href='asset_list.jsp'");
	script.println("</script>");
}

Asset asset = new AssetDAO().getAsset(no);
if(!userID.equals(asset.getUserID())){
	PrintWriter script=response.getWriter();
	script.println("<script>");
	script.println("alert('권한이 없습니다.')");
	script.println("location.href='asset_list.jsp'");
	script.println("</script>");
} else{
      if(request.getParameter("asset_name")==null||request.getParameter("priority")==null||
    						  request.getParameter("asset_type")==null||request.getParameter("inter_face")==null||
    								  request.getParameter("protocol")==null||request.getParameter("os_type").equals("")){
               PrintWriter script=response.getWriter();
               script.println("<script>");
               script.println("alert('입력이 안 된 사항이 있습니다.')");
               script.println("history.back()");
               script.println("</script>");
            }else{
               AssetDAO assetDAO = new AssetDAO();
               int result = assetDAO.write(asset.getAsset_name(),asset.getPriority(), asset.getAccount_manage(),asset.getEncryption(),asset.getLogging(),asset.getEncryption(),asset.getAsset_type(),asset.getInter_face(),asset.getProtocol(),asset.getOs_type(),asset.getUsages(),asset.getUserID());
               if(result==-1){
                  PrintWriter script=response.getWriter();
                  script.println("<script>");
                  script.println("alert('자산리스트 추가에 실패했습니다.')");
                  script.println("</script>");
               }else{ 
                  PrintWriter script=response.getWriter();
                  script.println("<script>");
                  script.println("location.href='asset_list.jsp'");
                  script.println("</script>");
               }
            }
   }
   %>
<%

request.setCharacterEncoding("utf-8");
String re_asset_name=request.getParameter("asset_name");                  
String re_priority=request.getParameter("priority");      
String re_account_manage=request.getParameter("account_manage");                  
String re_encryption=request.getParameter("encryption");                  
String re_logging=request.getParameter("logging");                  
String re_external_connect=request.getParameter("external_connect");                  
String re_asset_type=request.getParameter("asset_type");        
String re_inter_face=request.getParameter("inter_face");
String re_protocol=request.getParameter("protocol");
String re_os_type=request.getParameter("os_type");
String re_usages=request.getParameter("usages");

Class.forName("com.mysql.cj.jdbc.Driver");

Connection conn=null;
PreparedStatement pstmt=null;

try{
    String dbURL ="jdbc:mysql://ics-vaprogram.cti5lacaght2.ap-northeast-2.rds.amazonaws.com:3306/ICS2?useUnicode=true&characterEncoding=utf8";	       
	String dbID = "admin";
	String dbPassword = "password";
	 conn= DriverManager.getConnection(dbURL, dbID, dbPassword);
		              pstmt=conn.prepareStatement("INSERT INTO AssetTable(asset_name,priority,account_manage,encryption,logging,external_connect,asset_type,inter_face,protocol,os_type,usages) VALUES(?,?,?,?,?,?,?,?,?,?,?)");
		       		  pstmt.setString(1, re_asset_name);
		              pstmt.setString(2, re_priority);
		              pstmt.setString(3, re_account_manage);
		              pstmt.setString(4, re_encryption);
		              pstmt.setString(5, re_logging);
		              pstmt.setString(6, re_external_connect);
		              pstmt.setString(7, re_asset_type);
		              pstmt.setString(8, re_inter_face);
		              pstmt.setString(9, re_protocol);
		              pstmt.setString(10, re_os_type);
		              pstmt.setString(11, re_usages);
		  			System.out.println("과연 여기는???");

		             int i= pstmt.executeUpdate();
		             System.out.println("i"+i);
		              System.out.println("updatemember실행~!!!!!!!");
		      }  finally{
		    	  if(pstmt!=null)try{pstmt.close();}catch(SQLException ex){}
		    	  if(conn!=null)try{conn.close();}catch(SQLException ex){}
		    	  if(conn!=null)try{conn.close();}catch(SQLException ex){}
		      }
%>
       
   </div>
</body>
</html> 

 

